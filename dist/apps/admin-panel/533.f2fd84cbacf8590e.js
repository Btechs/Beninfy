"use strict";(self.webpackChunkadmin_panel=self.webpackChunkadmin_panel||[]).push([[533],{6533:(oe,C,a)=>{a.r(C),a.d(C,{OverviewModule:()=>ne});var g=a(9826),h=a(655),v=a(9808),e=a(5e3),s=a(7157),T=a(4004),x=a(3905),u=a(3315),q=a(4610),D=a(3266),O=a(1646),p=a(7336),y=a(6771),I=a(4251),L=a(2998),d=a(3075),A=a(1062),J=a(1670);function F(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"tr"),e.TgZ(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.ALo(5,"phone"),e.qZA(),e.TgZ(6,"td"),e.TgZ(7,"nz-tag",7),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.qZA(),e.TgZ(10,"td"),e.TgZ(11,"a",8),e.NdJ("click",function(){const l=e.CHM(t).$implicit;return e.oxw().showDriverOnMap(l.id)}),e._uU(12,"Show on Map"),e.qZA(),e._UZ(13,"nz-divider",9),e.TgZ(14,"a",10),e._uU(15),e.ALo(16,"translate"),e.qZA(),e.qZA(),e.qZA()}if(2&n){const t=i.$implicit,o=e.oxw();e.xp6(2),e.AsE("",t.firstName||""," ",t.lastName||"",""),e.xp6(2),e.Oqu(null!==t.mobileNumber?e.lcZ(5,7,t.mobileNumber):""),e.xp6(3),e.Q6J("nzColor",o.tagColor.driver(t.status)),e.xp6(1),e.Oqu(e.lcZ(9,9,"enum.driver.status."+o.toCamelCase(t.status))),e.xp6(6),e.Q6J("routerLink","/drivers/view/"+t.id),e.xp6(1),e.Oqu(e.lcZ(16,11,"profile.view"))}}function U(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"span",11),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"nz-switch",12),e.NdJ("ngModelChange",function(r){return e.CHM(t),e.oxw().autoZoom=r}),e.qZA()}if(2&n){const t=e.oxw();e.xp6(1),e.Oqu(e.lcZ(2,2,"overview.autoZoom")),e.xp6(2),e.Q6J("ngModel",t.autoZoom)}}const Q=function(){return{draggable:!1}};function N(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"map-marker",16,17),e.NdJ("mapClick",function(){const l=e.CHM(t).$implicit,c=e.MAs(1);return e.oxw(3).openInfoWindow(c,l.driverId)}),e.qZA()}2&n&&e.Q6J("position",i.$implicit.location)("options",e.DdM(2,Q))}function Y(n,i){if(1&n&&(e.TgZ(0,"google-map",14),e.YNc(1,N,2,3,"map-marker",15),e.TgZ(2,"map-info-window"),e.TgZ(3,"a",10),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.qZA(),e.qZA()),2&n){const t=i.ngIf,o=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",t),e.xp6(2),e.Q6J("routerLink","/drivers/view/"+o.selectedDriverId),e.xp6(1),e.Oqu(e.lcZ(5,3,"overview.viewDriver"))}}function b(n,i){if(1&n&&(e.YNc(0,Y,6,5,"google-map",13),e.ALo(1,"async")),2&n){const t=e.oxw();let o;e.Q6J("ngIf",null==(o=e.lcZ(1,1,t.query))||null==o.data?null:o.data.getDriversLocation)}}let P=(()=>{class n{constructor(t,o){this.tagColor=t,this.route=o,this.page=1,this.total=1,this.listOfData=[],this.locations=[],this.autoZoom=!1}ngOnInit(){this.query=this.route.data.pipe((0,T.U)(t=>t.overview))}ngAfterViewInit(){var t;this.subscription=null===(t=this.query)||void 0===t?void 0:t.subscribe(o=>{this.listOfData=o.data.drivers.nodes,this.locations=o.data.getDriversLocation,this.centerMap()})}centerMap(){if(0==this.locations.length)return void(this.map.zoom=1);if(1==this.locations.length)return void this.map.panTo(this.locations[0].location);const t=new google.maps.LatLngBounds;for(const o of this.locations)t.extend(o.location);this.map.fitBounds(t)}openInfoWindow(t,o){this.selectedDriverId=o,this.infoWindow.open(t)}toCamelCase(t){return(0,q.eV)(t)}searchData(){return(0,h.mG)(this,void 0,void 0,function*(){})}showDriverOnMap(t){this.map.panTo(this.locations.filter(o=>o.driverId==parseInt(t))[0].location)}ngOnDestroy(){var t;null===(t=this.subscription)||void 0===t||t.unsubscribe()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(D.k),e.Y36(g.gz))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-overview-drivers-map"]],viewQuery:function(t,o){if(1&t&&(e.Gf(u.ch,5),e.Gf(u.b6,5)),2&t){let r;e.iGM(r=e.CRH())&&(o.infoWindow=r.first),e.iGM(r=e.CRH())&&(o.map=r.first)}},decls:24,vars:23,consts:[[3,"nzTitle","nzExtra","nzCover"],["nzBordered","",3,"nzFrontPagination","nzData","nzTotal","nzPageIndex","nzPageSize","nzPageIndexChange","nzPageSizeChange"],["ajaxTable",""],["nzColumnKey","status"],[4,"ngFor","ngForOf"],["extraTemplate",""],["mapTpl",""],[3,"nzColor"],[3,"click"],["nzType","vertical"],[3,"routerLink"],[2,"padding-right","10px"],["nzCheckedChildren","1","nzUnCheckedChildren","0",3,"ngModel","ngModelChange"],["height","400px","width","100%",4,"ngIf"],["height","400px","width","100%"],[3,"position","options","mapClick",4,"ngFor","ngForOf"],[3,"position","options","mapClick"],["marker","mapMarker"]],template:function(t,o){if(1&t&&(e.TgZ(0,"nz-card",0),e.ALo(1,"translate"),e.TgZ(2,"nz-table",1,2),e.NdJ("nzPageIndexChange",function(l){return o.page=l})("nzPageIndexChange",function(){return o.searchData()})("nzPageSizeChange",function(){return o.searchData()}),e.TgZ(4,"thead"),e.TgZ(5,"tr"),e.TgZ(6,"th"),e._uU(7),e.ALo(8,"translate"),e.qZA(),e.TgZ(9,"th"),e._uU(10),e.ALo(11,"translate"),e.qZA(),e.TgZ(12,"th",3),e._uU(13),e.ALo(14,"translate"),e.qZA(),e.TgZ(15,"th"),e._uU(16),e.ALo(17,"translate"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(18,"tbody"),e.YNc(19,F,17,13,"tr",4),e.qZA(),e.qZA(),e.qZA(),e.YNc(20,U,4,4,"ng-template",null,5,e.W1O),e.YNc(22,b,2,3,"ng-template",null,6,e.W1O)),2&t){const r=e.MAs(3),l=e.MAs(21),c=e.MAs(23);e.Q6J("nzTitle",e.lcZ(1,13,"overview.driversOnline"))("nzExtra",l)("nzCover",c),e.xp6(2),e.Q6J("nzFrontPagination",!1)("nzData",o.listOfData)("nzTotal",o.total)("nzPageIndex",o.page)("nzPageSize",5),e.xp6(5),e.hij(" ",e.lcZ(8,15,"profile.name")," "),e.xp6(3),e.hij(" ",e.lcZ(11,17,"profile.mobileNumber")," "),e.xp6(3),e.Oqu(e.lcZ(14,19,"profile.status")),e.xp6(3),e.Oqu(e.lcZ(17,21,"profile.actions")),e.xp6(3),e.Q6J("ngForOf",r.data)}},directives:[O.bd,p.N8,p.Om,p.$Z,p.Uo,p._C,p.qD,p.p0,v.sg,y.j,I.g,g.yS,L.i,d.JJ,d.On,v.O5,u.b6,u.ch,u.O_],pipes:[A.X$,J.E,v.Ov],encapsulation:2}),n})();var R=a(8208),E=a(7447),S=a(7036),W=a(9997),_=a(2192);function G(n,i){1&n&&e._UZ(0,"i",13)}function V(n,i){1&n&&e._UZ(0,"i",14)}function H(n,i){1&n&&e._UZ(0,"i",15)}function B(n,i){1&n&&e._UZ(0,"i",16)}function $(n,i){if(1&n&&(e.TgZ(0,"div",7),e.TgZ(1,"div",2),e.TgZ(2,"nz-card"),e._UZ(3,"nz-statistic",8),e.ALo(4,"translate"),e.ALo(5,"translate"),e.YNc(6,G,1,0,"ng-template",null,9,e.W1O),e.qZA(),e.qZA(),e.TgZ(8,"div",2),e.TgZ(9,"nz-card"),e._UZ(10,"nz-statistic",8),e.ALo(11,"translate"),e.ALo(12,"translate"),e.YNc(13,V,1,0,"ng-template",null,10,e.W1O),e.qZA(),e.qZA(),e.TgZ(15,"div",2),e.TgZ(16,"nz-card"),e._UZ(17,"nz-statistic",8),e.ALo(18,"translate"),e.ALo(19,"translate"),e.YNc(20,H,1,0,"ng-template",null,11,e.W1O),e.qZA(),e.qZA(),e.TgZ(22,"div",2),e.TgZ(23,"nz-card"),e._UZ(24,"nz-statistic",8),e.ALo(25,"translate"),e.ALo(26,"translate"),e.YNc(27,B,1,0,"ng-template",null,12,e.W1O),e.qZA(),e.qZA(),e.qZA()),2&n){const t=i.ngIf,o=e.MAs(7),r=e.MAs(14),l=e.MAs(21),c=e.MAs(28);let m,f,Z,z;e.xp6(3),e.Q6J("nzValue",null!==(m=null==t.complaintAggregate[0].count?null:t.complaintAggregate[0].count.id)&&void 0!==m?m:0)("nzTitle",e.lcZ(4,16,"overview.complaints.title"))("nzPrefix",o)("nzSuffix",e.lcZ(5,18,"overview.complaints.suffix")),e.xp6(7),e.Q6J("nzValue",null!==(f=null==t.activeOrders[0].count?null:t.activeOrders[0].count.id)&&void 0!==f?f:0)("nzTitle",e.lcZ(11,20,"overview.activeOrders.title"))("nzPrefix",r)("nzSuffix",e.lcZ(12,22,"overview.activeOrders.suffix")),e.xp6(7),e.Q6J("nzValue",null!==(Z=null==t.driverAggregate[0].count?null:t.driverAggregate[0].count.id)&&void 0!==Z?Z:0)("nzTitle",e.lcZ(18,24,"overview.pendingDrivers.title"))("nzPrefix",l)("nzSuffix",e.lcZ(19,26,"overview.pendingDrivers.suffix")),e.xp6(7),e.Q6J("nzValue",null!==(z=null==t.bookedOrders[0].count?null:t.bookedOrders[0].count.id)&&void 0!==z?z:0)("nzTitle",e.lcZ(25,28,"overview.bookedOrders.title"))("nzPrefix",c)("nzSuffix",e.lcZ(26,30,"overview.availableDrivers.suffix"))}}function k(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"nz-radio-group",17),e.NdJ("ngModelChange",function(r){return e.CHM(t),e.oxw().requestMode=r})("ngModelChange",function(){return e.CHM(t),e.oxw().refreshRequests()}),e.TgZ(1,"label",18),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"label",19),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"label",20),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("ngModel",t.requestMode),e.xp6(2),e.Oqu(e.lcZ(3,4,"overview.chart.allDay")),e.xp6(3),e.Oqu(e.lcZ(6,6,"overview.chart.allMonth")),e.xp6(3),e.Oqu(e.lcZ(9,8,"overview.chart.allYear"))}}function j(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"nz-radio-group",17),e.NdJ("ngModelChange",function(r){return e.CHM(t),e.oxw().incomeMode=r})("ngModelChange",function(){return e.CHM(t),e.oxw().refreshIncome()}),e.TgZ(1,"label",18),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"label",19),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"label",20),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("ngModel",t.incomeMode),e.xp6(2),e.Oqu(e.lcZ(3,4,"overview.chart.allDay")),e.xp6(3),e.Oqu(e.lcZ(6,6,"overview.chart.allMonth")),e.xp6(3),e.Oqu(e.lcZ(9,8,"overview.chart.allYear"))}}const M=function(){return{height:300}};let X=(()=>{class n{constructor(t,o,r,l){this.locale=t,this.route=o,this.incomeChartGQL=r,this.requestsChartGQL=l,this.incomeMode=s.Do1.Monthly,this.requestMode=s.Do1.Monthly,this.chartTimeframe=s.Do1}ngOnInit(){this.query=this.route.data.pipe((0,T.U)(t=>t.overview)),this.refreshIncome(),this.refreshRequests()}refreshIncome(){return(0,h.mG)(this,void 0,void 0,function*(){const t=yield(0,x.z)(this.incomeChartGQL.fetch({timeframe:this.incomeMode})),o=this.getTimeFormatForQuery(this.incomeMode);t.data.incomeChart.items.forEach(r=>{r.time=(0,v.p6)(r.time,o,this.locale),r.sum=parseFloat(r.sum.toFixed(2))}),this.chartIncome.interval().position("time*sum").color("currency"),this.chartIncome.render(),this.chartIncome.interaction("active-region")})}refreshRequests(){return(0,h.mG)(this,void 0,void 0,function*(){const t=yield(0,x.z)(this.requestsChartGQL.fetch({timeframe:this.requestMode})),o=this.getTimeFormatForQuery(this.requestMode);t.data.requestChart.items.forEach(r=>{r.time=(0,v.p6)(r.time,o,this.locale),r.count=parseFloat(r.count.toString())}),this.chartRequests.data(t.data.requestChart.items),this.chartRequests.interval().position("time*count"),this.chartRequests.render(),this.chartRequests.interaction("active-region")})}getTimeFormatForQuery(t){switch(t){case s.Do1.Daily:return'h"';case s.Do1.Weekly:return"W,y";case s.Do1.Monthly:return"M/d";case s.Do1.Yearly:return"MMM y"}}colorForCount(t){return 0==t?"#87d068":t<10?"orange":"#CF1322"}onChartRequestsInit(t){this.chartRequests=t}onChartIncomeInit(t){this.chartIncome=t}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(e.soG),e.Y36(g.gz),e.Y36(s.nRb),e.Y36(s.fK_))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-overview"]],decls:16,vars:15,consts:[["class","lg:grid lg:grid-cols-4 lg:gap-2 mb-2",4,"ngIf"],[1,"lg:grid","lg:grid-cols-2","lg:gap-2"],[1,"mt-2"],[3,"nzTitle","nzExtra"],["nz-g2","",3,"nzChartOptions","nzChartInitialized"],["requestsExtrasTmpl",""],["incomeExtrasTmpl",""],[1,"lg:grid","lg:grid-cols-4","lg:gap-2","mb-2"],[3,"nzValue","nzTitle","nzPrefix","nzSuffix"],["prefixTplComplaints",""],["prefixTplpaymentRequests",""],["prefixTplPendingDrivers",""],["prefixTplAvailableDrivers",""],["nz-icon","","nzType","customer-service"],["nz-icon","","nzType","bank"],["nz-icon","","nzType","car"],["nz-icon","","nzType","user"],[3,"ngModel","ngModelChange"],["nz-radio-button","","nzValue","Daily"],["nz-radio-button","","nzValue","Monthly"],["nz-radio-button","","nzValue","Yearly"]],template:function(t,o){if(1&t&&(e.YNc(0,$,29,32,"div",0),e.ALo(1,"async"),e._UZ(2,"app-overview-drivers-map"),e.TgZ(3,"div",1),e.TgZ(4,"div",2),e.TgZ(5,"nz-card",3),e.ALo(6,"translate"),e.TgZ(7,"div",4),e.NdJ("nzChartInitialized",function(l){return o.onChartRequestsInit(l)}),e.qZA(),e.qZA(),e.YNc(8,k,10,10,"ng-template",null,5,e.W1O),e.qZA(),e.TgZ(10,"div",2),e.TgZ(11,"nz-card",3),e.ALo(12,"translate"),e.TgZ(13,"div",4),e.NdJ("nzChartInitialized",function(l){return o.onChartIncomeInit(l)}),e.qZA(),e.qZA(),e.YNc(14,j,10,10,"ng-template",null,6,e.W1O),e.qZA(),e.qZA()),2&t){const r=e.MAs(9),l=e.MAs(15);let c;e.Q6J("ngIf",null==(c=e.lcZ(1,7,o.query))?null:c.data),e.xp6(5),e.Q6J("nzTitle",e.lcZ(6,9,"overview.chart.requestsTitle"))("nzExtra",r),e.xp6(2),e.Q6J("nzChartOptions",e.DdM(13,M)),e.xp6(4),e.Q6J("nzTitle",e.lcZ(12,11,"overview.chart.incomeTitle"))("nzExtra",l),e.xp6(2),e.Q6J("nzChartOptions",e.DdM(14,M))}},directives:[v.O5,P,O.bd,R.A,E.my,S.w,W.Ls,_.Dg,d.JJ,d.On,_.Of,_.Bq],pipes:[v.Ov,A.X$],encapsulation:2}),n})(),w=(()=>{class n{constructor(t){this.gql=t}resolve(t,o){return this.gql.fetch()}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(s.q$b))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac}),n})();const K=[{path:"",component:X,resolve:{overview:w}}];let ee=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({providers:[w],imports:[[g.Bz.forChild(K)],g.Bz]}),n})();var te=a(4534);let ne=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[ee,te.m]]}),n})()}}]);